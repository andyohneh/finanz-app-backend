<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analyse-Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* ... Dein komplettes CSS von der Hauptseite ... */
    </style>
  </head>
  <body>
    <div class="header-container">
      <h1>Analyse-Dashboard: Performance</h1>
      <div class="theme-switch-wrapper">
        <label class="theme-switch" for="checkbox"
          ><input type="checkbox" id="checkbox" />
          <div class="slider round"></div
        ></label>
      </div>
    </div>

    {% for result in results %}
    <h2>🏆 Strategie-Performance für: {{ result.Symbol }}</h2>
    <div class="container">
      <table>
        <thead>
          <tr>
            <th>Gesamtrendite</th>
            <th>Gewinnrate</th>
            <th>Sharpe Ratio</th>
            <th>Anzahl Trades</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>+{{ result['Gesamtrendite_%'] }}%</td>
            <td>{{ result['Gewinnrate_%'] }}%</td>
            <td>{{ result.Sharpe_Ratio }}</td>
            <td>{{ result.Anzahl_Trades }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div
      id="chart-container-{{ result.Symbol.replace('/', '') }}"
      class="container"
      style="height: 50vh"
    >
      <canvas id="equity-chart-{{ result.Symbol.replace('/', '') }}"></canvas>
    </div>
    {% endfor %}

    <a href="/" class="back-link">Zurück zu den Live-Signalen</a>

    <script>
      // Dark Mode Logik (wie auf der Hauptseite)
      const themeSwitch = document.getElementById('checkbox');
      // ... (Rest der Dark Mode Logik)

      // NEU: Logik, um die Equity-Kurven zu zeichnen
      document.addEventListener('DOMContentLoaded', function() {
          const resultsData = {{ results | tojson }};

          resultsData.forEach(result => {
              const symbolId = result.Symbol.replace('/', '');
              const ctx = document.getElementById(`equity-chart-${symbolId}`).getContext('2d');

              const labels = result.equity_curve.map(item => item.timestamp);
              const data = result.equity_curve.map(item => item.equity);

              new Chart(ctx, {
                  type: 'line',
                  data: {
                      labels: labels,
                      datasets: [{
                          label: `Kapitalverlauf für ${result.Symbol}`,
                          data: data,
                          borderColor: '#2f855a',
                          backgroundColor: 'rgba(47, 133, 90, 0.1)',
                          fill: true,
                          tension: 0.1,
                          borderWidth: 2,
                          pointRadius: 0,
                      }]
                  },
                  options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      scales: { y: { ticks: { callback: value => `$${value}` } } }
                  }
              });
          });
      });
    </script>
  </body>
</html>
